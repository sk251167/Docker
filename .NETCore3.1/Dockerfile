# escape=`

#========================================================================================================================#
# Begin common commands                                                                                                  #
#========================================================================================================================#

# Using aspnet 3.1 core image
FROM mcr.microsoft.com/dotnet/aspnet:3.1

# Expose ports
EXPOSE 80 443

#========================================================================================================================#
# End common commands                                                                                                    #
#========================================================================================================================#

#========================================================================================================================#
# Begin application installation commands                                                                                #
#========================================================================================================================#

# Setting the working directory
WORKDIR '/Program Files/Application/'
		
# Copying files from host machine to container
COPY ["publish/", "."]

#========================================================================================================================#
# End application installation commands                                                                                  #
#========================================================================================================================#

#========================================================================================================================#
# The container stays up as long as this process is running                                                              #
#========================================================================================================================#

# Health check to verify the web service is running
HEALTHCHECK --interval=30s --timeout=10s --retries=10 `
    CMD curl --silent --fail http://localhost/api/Status || exit 1

# Set entry point
ENTRYPOINT ["dotnet", "Application.dll"]

#========================================================================================================================#